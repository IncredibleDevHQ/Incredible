fragment PublicUser on User {
  displayName
  picture
  username
}

fragment GuestUser on User {
  sub
  username
  verified
  email
}

fragment FlickParticipant on User {
  ...PublicUser
  email
  sub
}

fragment User on MeOutput {
  createdAt
  displayName
  email
  onboarded
  picture
  provider
  sub
  username
  updatedAt
}

query GetUser {
  Me {
    ...User
    verificationStatus
  }
}

fragment FilteredUser on User {
  displayName
  email
  picture
  sub
  username
}

query GetFilteredUsers($_ilike: String!) {
  User(
    where: {
      _or: [
        { displayName: { _ilike: $_ilike } }
        { email: { _ilike: $_ilike } }
        { username: { _ilike: $_ilike } }
      ]
    }
  ) {
    ...FilteredUser
  }
}

query IsUsernameAvailable($username: String!) {
  UsernameAvailability(username: $username) {
    message
    suggestion
    valid
  }
}

query GetGuestUser($state: String!) {
  User(where: { state: { _eq: $state } }) {
    ...GuestUser
  }
}

query FetchEmailUsingState($state: String!) {
  FetchEmailUsingState(state: $state) {
    email
  }
}

query SendMagicSignInLink($email: String!) {
  SendMagicLink(email: $email) {
    success
  }
}

query GetDashboard($sub: String!, $limit: Int) {
  Flick(
    where: {
      participants: { userSub: { _eq: $sub } }
      deletedAt: { _is_null: true }
    }
    order_by: { startAt: desc }
  ) {
    ...Flick
  }
  Series(limit: $limit, order_by: { createdAt: desc }) {
    ...PublicSeries
  }
}

mutation UpdateOnboardingUser(
  $sub: String!
  $displayName: String!
  $username: String!
) {
  update_User_by_pk(
    pk_columns: { sub: $sub }
    _set: { displayName: $displayName, username: $username }
  ) {
    updatedAt
  }
}

mutation SetOnboarding {
  Onboarded {
    success
  }
}

mutation UpdateProfile($displayName: String!, $userId: String!) {
  update_User(
    _set: { displayName: $displayName }
    where: { sub: { _eq: $userId } }
  ) {
    affected_rows
  }
}

mutation AddEmailToWaitlist($email: String!) {
  AddToWaitlist(email: $email) {
    success
  }
}
