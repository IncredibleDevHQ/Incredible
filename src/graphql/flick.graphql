fragment PublicFlick on Flick {
  color
  description
  joinLink
  lobbyPicture
  id
  name
  scope
  plannedEnd
  startAt
  updatedAt
  status
  deletedAt
  producedLink
  participants {
    user {
      picture
    }
  }
}

fragment Content on Content {
  id
  isPublic
  seriesId
  resource
  thumbnail
  type
}

fragment BaseFlick on Flick {
  color
  description
  joinLink
  lobbyPicture
  id
  name
  scope
  md
  plannedEnd
  startAt
  ownerId
  owner {
    userSub
  }
  updatedAt
  thumbnail
  status
  deletedAt
  producedLink
  configuration
  contents {
    ...Content
  }
  participants {
    user {
      sub
      displayName
      picture
    }
  }
}

fragment FlickActivity on FlickActivity {
  id
  title
  description
  type
  createdAt
  flickId
  fragmentId
}

fragment Flick on Flick {
  ...BaseFlick
  participants {
    ...FlickParticipants
  }
  fragments(order_by: { order: asc }) {
    ...FlickFragment
  }
}

query GetMyFlicks($limit: Int, $userId: String) {
  Flick(limit: $limit) {
    id
    name
    description
  }
}

query GetFlickById($id: uuid!) {
  Flick_by_pk(id: $id) {
    ...Flick
  }
}

query GetFlickMarkdownById($id: uuid!) {
  Flick_by_pk(id: $id) {
    id
    md
  }
}

query GetUpcomingUserFlicks($sub: String!) {
  Flick(
    where: {
      startAt: { _gte: "now()" }
      participants: { userSub: { _eq: $sub } }
    }
    order_by: { startAt: asc }
  ) {
    ...Flick
  }
}

query GetUserFlicks($sub: String!) {
  Flick(
    where: {
      participants: { userSub: { _eq: $sub } }
      deletedAt: { _is_null: true }
    }
    order_by: { startAt: desc }
  ) {
    ...Flick
  }
}

query GetUserPublicFlicks($userId: String!) {
  Flick(
    where: {
      scope: { _eq: Public }
      owner: { userSub: { _eq: $userId } }
      deletedAt: { _is_null: true }
    }
    order_by: { startAt: asc }
  ) {
    ...Flick
  }
}

query SeriesFlicks($id: uuid!) {
  Flick_Series(
    where: {
      seriesId: { _eq: $id }
      flick: { deletedAt: { _is_null: true }, scope: { _eq: Public } }
    }
  ) {
    order
    flick {
      ...BaseFlick
    }
  }
}

query GetFlickFragments($flickId: uuid!) {
  Fragment(where: { flickId: { _eq: $flickId } }) {
    ...FlickFragment
  }
}

query FlickActivity($flickId: uuid!) {
  FlickActivity(
    where: { flickId: { _eq: $flickId } }
    order_by: { createdAt: desc }
  ) {
    ...FlickActivity
  }
}

query GetFlickParticipants($flickId: uuid!) {
  Participant(
    where: { flickId: { _eq: $flickId } }
    order_by: { user: { displayName: asc } }
  ) {
    ...FlickParticipants
  }
}

query ZipStatus($flickId: uuid!) {
  Flick(where: { id: { _eq: $flickId } }) {
    downloadTasks
  }
}

mutation UpdateFlick(
  $flickId: String!
  $name: String!
  $organisationSlug: String
  $scope: UpdateFlickScopeEnum
  $difficulty: UpdateFlickDifficultyEnum
) {
  UpdateFlick(
    flickId: $flickId
    name: $name
    organisationSlug: $organisationSlug
    scope: $scope
    difficulty: $difficulty
  ) {
    id
  }
}

mutation UpdateFlickMarkdown($id: uuid!, $md: String!) {
  update_Flick_by_pk(pk_columns: { id: $id }, _set: { md: $md }) {
    id
  }
}

mutation UpdateFlickThumbnail($thumbnail: String, $id: uuid!) {
  update_Flick_by_pk(_set: { thumbnail: $thumbnail }, pk_columns: { id: $id }) {
    id
  }
}

mutation DeleteFlick($flickId: uuid!) {
  DeleteFlick(flickId: $flickId) {
    id
  }
}

mutation UpdateFlick(
  $flickId: String!
  $name: String!
  $organisationSlug: String
  $scope: UpdateFlickScopeEnum
  $difficulty: UpdateFlickDifficultyEnum
) {
  UpdateFlick(
    flickId: $flickId
    name: $name
    organisationSlug: $organisationSlug
    scope: $scope
    difficulty: $difficulty
  ) {
    id
  }
}

mutation UpdateFlickDetails(
  $flickId: String!
  $name: String!
  $description: String
) {
  UpdateFlick(flickId: $flickId, name: $name, description: $description) {
    id
  }
}

mutation UpdateParticipantRole(
  $participantId: String!
  $flickId: String!
  $role: UpdateParticipantRoleEnum!
) {
  UpdateParticipantRole(
    flickId: $flickId
    participantId: $participantId
    role: $role
  ) {
    id
  }
}

mutation CreateNewFlick(
  $name: String!
  $description: String
  $scope: CreateFlickFlickScopeEnumEnum!
  $seriesId: uuid
  $configuration: json
) {
  CreateFlick(
    name: $name
    scope: $scope
    description: $description
    seriesId: $seriesId
    configuration: $configuration
  ) {
    id
  }
}

mutation UpdateSeriesFlick($flickIds: [uuid!]!, $seriesId: uuid!) {
  UpdateSeriesFlicks(flickIds: $flickIds, seriesId: $seriesId) {
    success
  }
}

mutation InviteParticipantToFlick(
  $email: String!
  $flickId: String!
  $role: InviteParticipantRoleEnum!
) {
  InviteParticipant(email: $email, flickId: $flickId, role: $role) {
    id
  }
}

mutation GetFlickMarkdown($flickId: String!) {
  ProduceFlickMd(flickId: $flickId) {
    markdown
  }
}

mutation PublishFlick(
  $flickId: String!
  $interaction: [Interaction]
  $publishToBlogPlatforms: [BlogPlatforms]!
  $publishToFormats: [publishFormats]!
  $tags: _text
  $updatedDescription: String
  $updatedThumbnail: String!
  $updatedTitle: String
) {
  Publish(
    flickId: $flickId
    interactions: $interaction
    publishToBlogPlatforms: $publishToBlogPlatforms
    publishToFormats: $publishToFormats
    tags: $tags
    updatedDescription: $updatedDescription
    updatedThumbnail: $updatedThumbnail
    updatedTitle: $updatedTitle
  ) {
    success
  }
}

mutation UpdateFlickMd($id: uuid!, $md: String!) {
  update_Flick_by_pk(pk_columns: { id: $id }, _set: { md: $md }) {
    id
  }
}

mutation UpdateFlickTheme($id: uuid!, $theme: String!) {
  update_Flick_by_pk(pk_columns: { id: $id }, _set: { theme: $theme }) {
    id
    theme
  }
}

subscription FlickStatus($flickId: uuid!) {
  Flick_by_pk(id: $flickId) {
    status
  }
}
