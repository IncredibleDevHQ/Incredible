fragment FlickFragment on Fragment {
  configuration
  description
  flickId
  id
  name
  order
  type
  producedLink
}

fragment StudioFragment on Fragment {
  ...FlickFragment
  flick {
    ...BaseFlick
  }
}

query GetFragmentById($id: uuid!, $sub: String!) {
  Fragment(
    where: {
      _and: {
        id: { _eq: $id }
        flick: { participants: { userSub: { _eq: $sub } } }
      }
    }
  ) {
    ...StudioFragment
  }
}

mutation AddFragmentToFlick(
  $type: FRAGMENT_TYPE_ENUM_enum!
  $order: Int!
  $name: String!
  $flickId: uuid!
  $description: String!
) {
  insert_Fragment_one(
    object: {
      name: $name
      order: $order
      type: $type
      flickId: $flickId
      description: $description
    }
  ) {
    createdAt
  }
}

mutation MarkFragmentCompleted($id: uuid!, $producedLink: String!) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: { status: Completed, producedLink: $producedLink }
  ) {
    updatedAt
  }
}

mutation AddConfiguration($configuration: json!, $id: uuid!) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: { configuration: $configuration }
  ) {
    ...FlickFragment
  }
}
