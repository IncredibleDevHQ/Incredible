fragment FragmentParticipant on Fragment_Participant {
  participant {
    ...FlickParticipants
  }
}

fragment FlickFragment on Fragment {
  configuration
  description
  flickId
  id
  name
  order
  type
  producedLink
  producedShortsLink
  editorState
  participants {
    ...FragmentParticipant
  }
  flick {
    name
    description
  }
}

fragment StudioFragment on Fragment {
  ...FlickFragment
  flick {
    ...BaseFlick
  }
}

fragment Note on Note {
  id
  note
  sourceUrl
  createdAt
  participant {
    id
    userSub
    user {
      picture
      displayName
    }
  }
}

fragment RecordedBlocks on Blocks {
  id
  objectUrl
  updatedAt
}

fragment Recording on Recording {
  id
  type
  url
  status
  checkpoint
  thumbnail
  storyboard
}

query GetFragmentById($id: uuid!, $sub: String!) {
  Fragment(
    where: {
      _and: {
        id: { _eq: $id }
        flick: { participants: { userSub: { _eq: $sub } } }
      }
    }
  ) {
    ...StudioFragment
  }
}

query FragmentRole($fragmentId: uuid!, $sub: String!) {
  Participant(
    where: {
      _and: {
        fragments: {
          fragmentId: { _eq: $fragmentId }
          participant: { userSub: { _eq: $sub } }
        }
      }
    }
  ) {
    role
  }
}

query GetFragmentParticipants($fragmentId: uuid!) {
  Fragment_Participant(where: { fragmentId: { _eq: $fragmentId } }) {
    participant {
      ...FlickParticipants
    }
  }
}

query GetFragmentNotes($fragmentId: uuid!) {
  Note(where: { fragmentId: { _eq: $fragmentId } }) {
    ...Note
  }
}

query GetRecordings($flickId: uuid, $fragmentId: uuid) {
  Recording(
    where: { flickId: { _eq: $flickId }, fragmentId: { _eq: $fragmentId } }
  ) {
    ...Recording
  }
}

query GetRecordedBlocks($recordingId: uuid) {
  Blocks(where: { recordingId: { _eq: $recordingId } }) {
    ...RecordedBlocks
  }
}

mutation AddNote($note: Note_insert_input = {}) {
  insert_Note_one(object: $note) {
    id
  }
}

mutation UpdateNote($id: uuid!, $note: String!) {
  update_Note(where: { id: { _eq: $id } }, _set: { note: $note }) {
    affected_rows
  }
}

mutation DeleteNote($id: uuid!) {
  delete_Note_by_pk(id: $id) {
    id
  }
}

mutation AddFragmentToFlick(
  $type: FRAGMENT_TYPE_ENUM_enum!
  $order: Int!
  $name: String!
  $flickId: uuid!
  $description: String!
) {
  insert_Fragment_one(
    object: {
      name: $name
      order: $order
      type: $type
      flickId: $flickId
      description: $description
    }
  ) {
    createdAt
  }
}

mutation MarkFragmentCompleted(
  $id: uuid!
  $producedLink: String!
  $duration: float8!
) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: {
      status: Completed
      producedLink: $producedLink
      duration: $duration
    }
  ) {
    updatedAt
  }
}

mutation UpdateFragmentShort(
  $id: uuid!
  $producedShortsLink: String!
  $duration: float8!
) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: { producedShortsLink: $producedShortsLink, shortsDuration: $duration }
  ) {
    updatedAt
  }
}

mutation AddConfiguration($configuration: json!, $id: uuid!) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: { configuration: $configuration }
  ) {
    ...FlickFragment
  }
}

mutation UpdateFragmentState(
  $editorState: json!
  $id: uuid!
  $configuration: json!
) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: { editorState: $editorState, configuration: $configuration }
  ) {
    id
  }
}

mutation InsertParticipantToFragment(
  $participantId: uuid!
  $fragmentId: uuid!
) {
  InviteParticipantToFragment(
    fragmentId: $fragmentId
    participantId: $participantId
  ) {
    createdAt
  }
}

mutation CreateFragment(
  $flickId: uuid!
  $name: String!
  $description: String
  $creatorPid: uuid
  $speakerIds: [String] = []
) {
  CreateFragment(
    flickId: $flickId
    name: $name
    description: $description
    creatorParticipantId: $creatorPid
    speakerIds: $speakerIds
  ) {
    id
  }
}

mutation UpdateFragmentConfiguration($fragmentId: uuid!, $items: json!) {
  UpdateFragmentConfiguration(fragmentId: $fragmentId, items: $items) {
    success
  }
}

mutation DeleteFragment($id: uuid!) {
  DeleteFragmentbyID(id: $id) {
    id
  }
}

mutation ReorderFragment($fragmentIds: [uuid!]!, $flick_id: uuid!) {
  ReorderFragments(fragmentIds: $fragmentIds, flickId: $flick_id) {
    success
  }
}

mutation UpdateFragment(
  $fragmentId: String!
  $name: String
  $description: String
  $order: Int
) {
  UpdateFragment(
    fragmentId: $fragmentId
    name: $name
    description: $description
    order: $order
  ) {
    id
  }
}

mutation UpdateParticipants($fragmentId: String!, $participantIds: [String!]!) {
  UpdateFragmentParticipants(
    fragmentId: $fragmentId
    participantIds: $participantIds
  ) {
    added
    removed
  }
}

mutation UpdateFragmentMarkdown($fragmentId: uuid!, $md: String = "") {
  update_Fragment_by_pk(pk_columns: { id: $fragmentId }, _set: { md: $md }) {
    md
  }
}

mutation CompleteFragment(
  $duration: Int!
  $flickId: uuid!
  $fragmentId: uuid!
  $orientation: OrientationEnum!
  $producedLink: String!
) {
  CompleteFragment(
    flickId: $flickId
    fragmentId: $fragmentId
    orientation: $orientation
    producedLink: $producedLink
    duration: $duration
  ) {
    success
  }
}

mutation UpdateFragmentEditorState($id: uuid!, $editorState: json!) {
  update_Fragment_by_pk(
    pk_columns: { id: $id }
    _set: { editorState: $editorState }
  ) {
    id
  }
}

mutation SetupRecording(
  $contentType: CONTENT_TYPES!
  $editorState: json!
  $flickId: uuid!
  $fragmentId: uuid!
  $viewConfig: json!
) {
  StartRecording(
    contentType: $contentType
    flickId: $flickId
    fragmentId: $fragmentId
    editorState: $editorState
    viewConfig: $viewConfig
  ) {
    recordingId
    success
  }
}

mutation SaveRecordedBlock(
  $flickId: uuid!
  $fragmentId: uuid!
  $objectUrl: String!
  $recordingId: uuid!
  $blockId: String!
) {
  SaveBlock(
    flickId: $flickId
    fragmentId: $fragmentId
    objectUrl: $objectUrl
    recordingId: $recordingId
    blockId: $blockId
  ) {
    id
    success
  }
}
