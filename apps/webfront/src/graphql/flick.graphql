fragment BaseFlick on Flick {
	color
	description
	joinLink
	lobbyPicture
	id
	name
	scope
	md
	dirty
	plannedEnd
	publishedAt
	totalClaps
	startAt
	ownerId
	owner {
		userSub
	}
	updatedAt
	thumbnail
	status
	deletedAt
	producedLink
	useBranding
	brandingId
	branding {
		id
		name
		branding
	}
	theme {
		name
		config
	}
	configuration
	contents {
		...Content
	}
	topicTags
	participants {
		user {
			sub
			displayName
			picture
		}
	}
}

fragment Flick on Flick {
	...BaseFlick
	participants {
		...FlickParticipants
	}
	fragments(order_by: { order: asc }) {
		...FlickFragment
	}
	series {
		seriesId
		series {
			...Series
		}
	}
}

fragment PublicSeriesFlick on Flick {
	...BaseFlick
	participants {
		...SeriesParticipant
	}
}

query GetFlickById($id: uuid!) {
	Flick_by_pk(id: $id) {
		...Flick
	}
}

query GetFlick($joinLink: String!) {
	Flick(where: { joinLink: { _eq: $joinLink } }) {
		...Flick
	}
}

query GetUserFlicks($sub: String!) {
	Flick(
		where: {
			owner: { userSub: { _eq: $sub } }
			participants: { userSub: { _eq: $sub } }
			deletedAt: { _is_null: true }
		}
		order_by: { updatedAt: desc }
	) {
		...BaseFlick
	}
}

mutation CreateNewFlick(
	$name: String!
	$description: String
	$scope: CreateFlickFlickScopeEnumEnum!
	$seriesId: uuid
	$md: String
) {
	CreateFlick(
		name: $name
		scope: $scope
		description: $description
		seriesId: $seriesId
		md: $md
	) {
		id
		fragmentId
	}
}

mutation UpdateFlick(
	$flickId: String!
	$name: String!
	$organisationSlug: String
	$scope: UpdateFlickScopeEnum
	$difficulty: UpdateFlickDifficultyEnum
) {
	UpdateFlick(
		flickId: $flickId
		name: $name
		organisationSlug: $organisationSlug
		scope: $scope
		difficulty: $difficulty
	) {
		id
	}
}

mutation DeleteFlick($flickId: uuid!) {
	DeleteFlick(flickId: $flickId) {
		id
	}
}

mutation DuplicateUserFlick($flickId: uuid!) {
	DuplicateFlick(flickId: $flickId) {
		id
	}
}

mutation GetHuddleRtcToken($flickId: uuid!) {
	HuddleRtcToken(flickId: $flickId) {
		success
		token
	}
}

query GetFlickClapsByUser($flickId: uuid!, $sub: String!) {
	Flick(where: { id: { _eq: $flickId } }) {
		claps_aggregate(where: { userId: { _eq: $sub } }) {
			aggregate {
				count
			}
		}
	}
}

mutation ClapFlick($claps: Int!, $flickId: String!) {
	ClapFlick(claps: $claps, flickId: $flickId) {
		success
	}
}
